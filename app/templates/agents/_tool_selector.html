{% include 'agents/_base_selector.html' with context %}

<script>
document.addEventListener('DOMContentLoaded', function() {
    const addToolBtn = document.getElementById('addToolBtn');
    const availableTools = document.getElementById('available_tools');
    const container = document.getElementById('selected_tools_container');
    const noToolsMessage = document.getElementById('no_tools_message');

    addToolBtn.addEventListener('click', function() {
        const selected = availableTools.options[availableTools.selectedIndex];
        if (!selected.value) return;

        if (noToolsMessage) {
            noToolsMessage.remove();
        }

        const toolCard = document.createElement('div');
        toolCard.className = 'selected-item card mb-2';
        toolCard.dataset.itemId = selected.value;
        
        toolCard.innerHTML = `
            <div class="card-body p-3">
                <div class="d-flex justify-content-between align-items-start mb-2">
                    <h6 class="card-title mb-0">${selected.dataset.name}</h6>
                    <button type="button" class="btn-close" onclick="removeTool(this)"></button>
                </div>
                <div class="form-group">
                    <textarea class="form-control" 
                              name="tool_description_${selected.value}" 
                              placeholder="Describe how this tool will be used..."
                              rows="2">${selected.dataset.description || ''}</textarea>
                </div>
                <input type="hidden" name="tool_id" value="${selected.value}">
            </div>
        `;

        container.appendChild(toolCard);
        selected.disabled = true;
        availableTools.value = '';
    });
});

function removeTool(btn) {
    const card = btn.closest('.selected-item');
    const toolId = card.dataset.itemId;
    const container = document.getElementById('selected_tools_container');
    
    const option = document.querySelector(`#available_tools option[value="${toolId}"]`);
    if (option) option.disabled = false;
    
    card.remove();

    if (container.children.length === 0) {
        container.innerHTML = `
            <div class="text-center text-muted py-3" id="no_tools_message">
                No tools selected yet
            </div>
        `;
    }
}
</script>
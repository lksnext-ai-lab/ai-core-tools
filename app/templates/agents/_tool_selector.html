{# Tool Selector with Descriptions #}
<div class="tool-selector">
    <div class="card mb-4">
        <div class="card-header bg-light">
            <h6 class="mb-0">Add Tools</h6>
        </div>
        <div class="card-body">
            <div class="row align-items-end">
                <div class="col">
                    <label class="form-label">Select a tool to add</label>
                    <select class="form-select" id="available_tools">
                        <option value="">-- Select a tool --</option>
                        {% for tool in tools %}
                        <option value="{{ tool.agent_id }}" 
                                data-name="{{ tool.name }}"
                                data-description="{{ tool.description }}"
                                {% if tool in agent.tools %}disabled{% endif %}>
                            {{ tool.name }}
                        </option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-auto">
                    <button type="button" class="btn btn-primary" id="addToolBtn">
                        <i class="fas fa-plus"></i> Add Tool
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="card">
        <div class="card-header bg-light">
            <h6 class="mb-0">Selected Tools</h6>
        </div>
        <div class="card-body">
            <div id="selected_tools_container">
                {% if not agent.tool_associations %}
                <div class="text-center text-muted py-3" id="no_tools_message">
                    No tools selected yet
                </div>
                {% endif %}
                {% for tool_assoc in agent.tool_associations %}
                <div class="selected-tool card mb-2" data-tool-id="{{ tool_assoc.tool_id }}">
                    <div class="card-body p-3">
                        <div class="d-flex justify-content-between align-items-start mb-2">
                            <h6 class="card-title mb-0">{{ tool_assoc.tool.name }}</h6>
                            <button type="button" class="btn-close" onclick="removeTool(this)"></button>
                        </div>
                        <div class="form-group">
                            <textarea class="form-control" 
                                    name="tool_description_{{ tool_assoc.tool_id }}" 
                                    placeholder="Describe how this tool will be used..."
                                    rows="2">{{ tool_assoc.description }}</textarea>
                        </div>
                        <input type="hidden" name="tool_id" value="{{ tool_assoc.tool_id }}">
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const addToolBtn = document.getElementById('addToolBtn');
    const availableTools = document.getElementById('available_tools');
    const container = document.getElementById('selected_tools_container');
    const noToolsMessage = document.getElementById('no_tools_message');

    addToolBtn.addEventListener('click', function() {
        const selected = availableTools.options[availableTools.selectedIndex];
        if (!selected.value) return;

        // Remove "no tools" message if it exists
        if (noToolsMessage) {
            noToolsMessage.remove();
        }

        // Create new tool card
        const toolCard = document.createElement('div');
        toolCard.className = 'selected-tool card mb-2';
        toolCard.dataset.toolId = selected.value;
        
        toolCard.innerHTML = `
            <div class="card-body p-3">
                <div class="d-flex justify-content-between align-items-start mb-2">
                    <h6 class="card-title mb-0">${selected.dataset.name}</h6>
                    <button type="button" class="btn-close" onclick="removeTool(this)"></button>
                </div>
                <div class="form-group">
                    <textarea class="form-control" 
                              name="tool_description_${selected.value}" 
                              placeholder="Describe how this tool will be used..."
                              rows="2">${selected.dataset.description || ''}</textarea>
                </div>
                <input type="hidden" name="tool_id" value="${selected.value}">
            </div>
        `;

        container.appendChild(toolCard);
        selected.disabled = true;
        availableTools.value = '';
    });
});

function removeTool(btn) {
    const card = btn.closest('.selected-tool');
    const toolId = card.dataset.toolId;
    const container = document.getElementById('selected_tools_container');
    
    // Re-enable the option in the select
    const option = document.querySelector(`#available_tools option[value="${toolId}"]`);
    if (option) option.disabled = false;
    
    card.remove();

    // If no tools left, show the message
    if (container.children.length === 0) {
        container.innerHTML = `
            <div class="text-center text-muted py-3" id="no_tools_message">
                No tools selected yet
            </div>
        `;
    }
}
</script>
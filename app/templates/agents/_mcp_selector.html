{% include 'agents/_base_selector.html' with context %}

<script>
document.addEventListener('DOMContentLoaded', function() {
    const addMcpBtn = document.getElementById('addMcpBtn');
    const availableMcps = document.getElementById('available_mcps');
    const container = document.getElementById('selected_mcps_container');
    const noMcpsMessage = document.getElementById('no_mcps_message');

    addMcpBtn.addEventListener('click', function() {
        const selected = availableMcps.options[availableMcps.selectedIndex];
        if (!selected.value) return;

        if (noMcpsMessage) {
            noMcpsMessage.remove();
        }

        const mcpCard = document.createElement('div');
        mcpCard.className = 'selected-item card mb-2';
        mcpCard.dataset.itemId = selected.value;
        
        mcpCard.innerHTML = `
            <div class="card-body p-3">
                <div class="d-flex justify-content-between align-items-start mb-2">
                    <h6 class="card-title mb-0">${selected.dataset.name}</h6>
                    <button type="button" class="btn-close" onclick="removeMcp(this)"></button>
                </div>
                <div class="form-group">
                    <textarea class="form-control" 
                              name="mcp_description_${selected.value}" 
                              placeholder="Describe how this MCP will be used..."
                              rows="2">${selected.dataset.description || ''}</textarea>
                </div>
                <input type="hidden" name="mcp_config_id" value="${selected.value}">
            </div>
        `;

        container.appendChild(mcpCard);
        selected.disabled = true;
        availableMcps.value = '';
    });
});

function removeMcp(btn) {
    const card = btn.closest('.selected-item');
    const mcpId = card.dataset.itemId;
    const container = document.getElementById('selected_mcps_container');
    
    const option = document.querySelector(`#available_mcps option[value="${mcpId}"]`);
    if (option) option.disabled = false;
    
    card.remove();

    if (container.children.length === 0) {
        container.innerHTML = `
            <div class="text-center text-muted py-3" id="no_mcps_message">
                No MCPs selected yet
            </div>
        `;
    }
}
</script>

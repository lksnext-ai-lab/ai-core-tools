<!-- Sidebar START -->
<nav class="navbar sidebar navbar-expand-xl navbar-light">
    <!-- Navbar brand for xl START -->
    <div class="d-flex align-items-center">
        <a class="navbar-brand" href="/">
            <img class="light-mode-item navbar-brand-item"
                src="{{ url_for('static', filename='img/mattin-ai.png') }}" alt="logo">
            <img class="dark-mode-item navbar-brand-item" src="{{ url_for('static', filename='img/mattin-ai.png.svg') }}"
                alt="logo">
        </a>
    </div>
    <!-- Navbar brand for xl END -->

    <div class="offcanvas offcanvas-start flex-row custom-scrollbar h-100" data-bs-backdrop="true" tabindex="-1"
        id="offcanvasSidebar">
        <div class="offcanvas-body p-0">
            <div class="d-flex flex-column h-100">
                {% if session and session['app_name'] %}
                <!-- App specific menu -->
                <div class="card bg-light w-100">
                    <!-- Edit profile button -->
                    <div class="position-absolute top-0 end-0 p-3">
                        <a href="{{ url_for('my_apps') }}" class="text-primary-hover" data-bs-toggle="tooltip"
                            data-bs-title="Leave app">
                            <i class="bi bi-close bi-box-arrow-right"></i>
                        </a>
                    </div>

                    <!-- Card body START -->
                    <div class="card-body p-3">
                        <!-- Avatar and content -->
                        <div class="text-center mb-3">
                            <h6 class="mb-0">{{session['app_name']}}</h6>
                            <hr>
                        </div>

                        <!-- Sidebar menu item START -->
                        <ul class="nav nav-pills-primary-soft flex-column">
                            <li class="nav-item">
                                <a class="nav-link"
                                    href="{{url_for('agents.app_agents', app_id=session['app_id']) }}"><i
                                        class="bi bi-robot fa-fw me-2"></i>Agents</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link"
                                    href="{{url_for('repositories.repositories', app_id=session['app_id']) }}"><i
                                        class="bi bi-folder fa-fw me-2"></i>Repositories</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="{{ url_for('domains.domains') }}"><i
                                        class="bi bi-diagram-3 fa-fw me-2"></i>Domains</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link"
                                    href="{{ url_for('output_parsers.app_output_parsers', app_id=session['app_id']) }}">
                                    <i class="bi bi-file-text fa-fw me-2"></i>Data Structures
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="{{ url_for('silos.silos', app_id=session['app_id']) }}"><i
                                        class="bi bi-database fa-fw me-2"></i>Silos</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="{{ url_for('ai_services.app_ai_services', app_id=session['app_id']) }}"><i
                                    class="bi bi-hdd-rack fa-fw me-2"></i>AI Services</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="{{ url_for('embedding_services.app_embedding_services', app_id=session['app_id']) }}"><i
                                    class="bi bi-hdd-rack fa-fw me-2"></i>Embedding Services</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="{{ url_for('mcp_configs.app_mcp_configs', app_id=session['app_id']) }}"><i
                                    class="bi bi-plug fa-fw me-2"></i>MCP Configs</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="{{ url_for('api_keys.list_api_keys') }}"><i
                                        class="bi bi-ticket-perforated fa-fw me-2"></i>API Keys</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="{{ url_for('app_settings.app_settings', app_id=session['app_id']) }}"><i
                                        class="bi bi-gear fa-fw me-2"></i>Settings</a>
                            </li>
                        </ul>
                        <!-- Sidebar menu item END -->
                    </div>
                    <!-- Card body END -->
                </div>
                {% endif %}

                <!-- Global menu -->
                <ul class="navbar-nav flex-column mt-3">
                    {% if session %}
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('my_apps') }}"><i
                            class="bi bi-window-stack fa-fw me-2"></i>My Apps</a>
                    </li>
                    {% endif %}

                    {% if session and session['is_omniadmin'] %}
                    <li class="nav-item">
                        <a class="nav-link" data-bs-toggle="collapse" href="#adminSubmenu" role="button" aria-expanded="false" aria-controls="adminSubmenu">
                            <i class="bi bi-shield-lock fa-fw me-2"></i>Admin
                            <i class="bi bi-chevron-down float-end"></i>
                        </a>
                        <div class="collapse" id="adminSubmenu">
                            <ul class="nav flex-column ms-3">
                                <li class="nav-item">
                                    <a class="nav-link" href="{{ url_for('admin_users.list_users') }}">
                                        <i class="bi bi-people fa-fw me-2"></i>Users
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="#">
                                        <i class="bi bi-clipboard2-data fa-fw me-2"></i>Stats
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </li>
                    {% endif %}

                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('about') }}"><i
                            class="bi bi-info-circle fa-fw me-2"></i>About</a>
                    </li>
                </ul>

                <!-- Sidebar footer -->
                <div class="mt-auto p-3">
                    {% if session and session['user'] %}
                    <div class="d-flex align-items-center justify-content-between text-primary-hover">
                        <a class="h6 fw-light mb-0 text-body" href="{{ url_for('logout') }}" data-bs-toggle="tooltip"
                            data-bs-placement="top" aria-label="Sign out">
                            <i class="fa-solid fa-arrow-right-from-bracket"></i> Log out
                        </a>
                        <a class="h6 mb-0 text-body" href="admin-settings.html" data-bs-toggle="tooltip"
                            data-bs-placement="top" aria-label="Settings">
                            <i class="bi bi-gear-fill"></i>
                        </a>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</nav>
<!-- Sidebar END -->